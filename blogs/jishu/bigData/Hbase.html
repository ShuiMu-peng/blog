<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.14">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <link rel="icon" href="/blog/avatar.png"><title>Hbase | Game</title><meta name="description" content="shuiMu's blog">
    <link rel="preload" href="/blog/assets/style-BtcQQSZj.css" as="style"><link rel="stylesheet" href="/blog/assets/style-BtcQQSZj.css">
    <link rel="modulepreload" href="/blog/assets/app-D6sLFLco.js"><link rel="modulepreload" href="/blog/assets/Hbase.html-M4HGs3BZ.js">
    <link rel="prefetch" href="/blog/assets/timeline.html-Bo1ygdqA.js" as="script"><link rel="prefetch" href="/blog/assets/posts.html-D_DFb0sG.js" as="script"><link rel="prefetch" href="/blog/assets/friendship-link.html-BYGzRc8g.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-MZp3L37T.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-Yahd-4aq.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CMpzmdEc.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BiIO-Vt-.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DXPnkgQH.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-XCZe2MOe.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-D6bMwjcC.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-N2VlrG06.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BFboKL_b.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-C6hdjo5G.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BT7QeWWK.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CX2XQKwU.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BnDurgHV.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DH0cDeY8.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-D2C1zCcz.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DwxyzQYI.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CjcpCMwo.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-D19xNKN3.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-w-6xtSEK.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-wHb5UbHC.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DeKNitNF.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BcK9-yiZ.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CeStWITe.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-BB6ZAHXx.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CFkbz0GN.js" as="script"><link rel="prefetch" href="/blog/assets/guanggaoguiyin.html-DVHbUuVH.js" as="script"><link rel="prefetch" href="/blog/assets/flink-to-clickHouse.html-yS_CbIFJ.js" as="script"><link rel="prefetch" href="/blog/assets/ES.html-GfVMJ_z0.js" as="script"><link rel="prefetch" href="/blog/assets/kafka_1.html-BNcx30e6.js" as="script"><link rel="prefetch" href="/blog/assets/kafka_consumer.html-DC_b2tIp.js" as="script"><link rel="prefetch" href="/blog/assets/kafka_disk_migration.html-Bu9jxU-l.js" as="script"><link rel="prefetch" href="/blog/assets/kafka_product.html-CsxKjMkQ.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ.html-Bt3keSkV.js" as="script"><link rel="prefetch" href="/blog/assets/Rocket.html-CQFuC8I1.js" as="script"><link rel="prefetch" href="/blog/assets/mysql.html-BQVSs594.js" as="script"><link rel="prefetch" href="/blog/assets/Redisson.html-Bthuif6h.js" as="script"><link rel="prefetch" href="/blog/assets/redis.html-C9I2riD7.js" as="script"><link rel="prefetch" href="/blog/assets/scheduler.html-DR22xtlG.js" as="script"><link rel="prefetch" href="/blog/assets/sentinel_shiyong(1).html-2PYEQlOH.js" as="script"><link rel="prefetch" href="/blog/assets/sentinel_yuanmafenxi.html-D3jEAVcy.js" as="script"><link rel="prefetch" href="/blog/assets/mybatisPlus-clickHouse.html-eiAmDPVy.js" as="script"><link rel="prefetch" href="/blog/assets/Zookeeper.html-ChENi7b8.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-Dxi34Djb.js" as="script"><link rel="prefetch" href="/blog/assets/Valine.min-Dm4Ijz6H.js" as="script"><link rel="prefetch" href="/blog/assets/giscus-aTimukGI-CKTvSCx2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container series--no show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/blog/logo.png" alt="Game"><a href="/blog/" class="site-name can-hide">Game</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/blog/" class="link router-link-active" aria-label="Home"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Home<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="Categories"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Categories<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="Categories"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Categories<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/blog/categories/jishu/1.html" class="link" aria-label="技术"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->技术<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/categories/yewu/1.html" class="link" aria-label="业务"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->业务<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="Tags"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Tags<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="Tags"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Tags<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/blog/tags/sentinel/1.html" class="link" aria-label="sentinel"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->sentinel<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/guanggaojiance/1.html" class="link" aria-label="广告监测"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->广告监测<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/quartz/1.html" class="link" aria-label="quartz"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->quartz<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/dolphinScheduler/1.html" class="link" aria-label="dolphinScheduler"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->dolphinScheduler<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/xxl-job/1.html" class="link" aria-label="xxl-job"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->xxl-job<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/hbase/1.html" class="link" aria-label="hbase"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->hbase<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/mysql/1.html" class="link" aria-label="mysql"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->mysql<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/zookeeper/1.html" class="link" aria-label="zookeeper"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->zookeeper<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/flink/1.html" class="link" aria-label="flink"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->flink<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/clickHouse/1.html" class="link" aria-label="clickHouse"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->clickHouse<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/mq/1.html" class="link" aria-label="mq"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->mq<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/rocketmq/1.html" class="link" aria-label="rocketmq"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->rocketmq<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/mybatis-plus/1.html" class="link" aria-label="mybatis-plus"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->mybatis-plus<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/clickhouse/1.html" class="link" aria-label="clickhouse"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->clickhouse<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/Redis/1.html" class="link" aria-label="Redis"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/Redisson/1.html" class="link" aria-label="Redisson"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redisson<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/elasticSearch/1.html" class="link" aria-label="elasticSearch"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->elasticSearch<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/kafka/1.html" class="link" aria-label="kafka"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->kafka<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog/tags/RabbitMq/1.html" class="link" aria-label="RabbitMq"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->RabbitMq<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><a href="/blog/timeline.html" class="link" aria-label="时间轴"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->时间轴<!--]--></span></span><!--[--><!--]--></a></div><!--]--></nav><span class="xicon-container btn-toggle-dark-mode btn--dark-mode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><!----><!----><!----><div class="theme-main" style=""><!----><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">Hbase</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->shuiMu<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2022-07-13<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/blog/categories/jishu/1.html" class="">技术</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/blog/tags/hbase/1.html" class="">hbase</a><!--]--><!--]--></span></span><!----></div><div class="theme-reco-md-content"><div><h2 id="hbase概述" tabindex="-1"><a class="header-anchor" href="#hbase概述"><span>Hbase概述</span></a></h2><blockquote><p>Apache Hbase 是以HDFS存储的，一种分布式、可扩展的NoSql数据库</p></blockquote><h3 id="数据模型" tabindex="-1"><a class="header-anchor" href="#数据模型"><span>数据模型</span></a></h3><p>Hbase的设计理念，依据Google的BigTable论文（BigTable是一个<code>稀疏的</code>、<code>分布式的</code>、<code>持久的</code>多维排序map）</p><blockquote><p>map：<code>key-Value</code>，该映射，由行键、列键和时间戳索引；映射的每个值，都是一个未解释的字节数组（序列化后的byte）。</p></blockquote><p><code>Hbase</code> 关于数据模型和<code>BigTable</code>的对应关系如下：</p><blockquote><p><code>Hbase</code> 使用的与<code>BigTable</code>非常相似的数据模型。用户将数据行存储在带标签的表中，数据行具有可排序的键和任意数量的列，该表存储稀疏，因此如果有用户喜欢，同一表中的行，可以具有疯狂变化的列</p></blockquote><p>最终理解<code>Hbase</code>数据模型的关键在于：<code>稀疏</code>、<code>分布式</code>、<code>多维</code>、<code>排序</code>的<code>key-Value</code>结构</p><h4 id="逻辑结构" tabindex="-1"><a class="header-anchor" href="#逻辑结构"><span>逻辑结构</span></a></h4><p>Hbase可以用于存储多种结构的数据，以 JSON 为例，存储的数据原貌为：</p><blockquote><p>注意：</p><ul><li><code>rowkey</code>的ASCII码排序，小的在前大的在后</li><li>每个列族下，字段可任意删减增加</li></ul></blockquote><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre class="language-json"><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;row_key1&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;user_info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token string">&quot;23&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;sex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;男&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;office_info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;beijing&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;tel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;010-111111&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;company_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;腾云天下&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;row_key11&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;user_info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token string">&quot;23&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;office_info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;beijing&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token property">&quot;company_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;腾云天下&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;row_key2&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">&quot;user_info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wangwu&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token property">&quot;office_info&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;beijing&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    .......</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，每个列族下，字段可为空，稀疏存储</p><p><img src="/blog/Hbase.assets/image-20221128213442507.png" alt="image-20221128213442507"></p><h4 id="物理结构" tabindex="-1"><a class="header-anchor" href="#物理结构"><span>物理结构：</span></a></h4><p>物理存储结构即为数据的映射关系，在逻辑视图中的空单元格，底层实际根本不存储</p><p>每个表的，每个列族存储为一个 <code>StoreFile</code></p><p><img src="/blog/Hbase.assets/image-20221128213727752.png" alt="image-20221128213727752"></p><h4 id="数据模型-1" tabindex="-1"><a class="header-anchor" href="#数据模型-1"><span>数据模型：</span></a></h4><h5 id="name-space" tabindex="-1"><a class="header-anchor" href="#name-space"><span>name space</span></a></h5><blockquote><p>命名空间，类似 <code>database</code>的概念，有两个自带的命名空间，分别是<code>habse</code>和<code>default</code>，<code>hbase</code>中存放的是Hbase内置表，<code>default</code> 是用户默认使用的命名空间</p></blockquote><h5 id="table" tabindex="-1"><a class="header-anchor" href="#table"><span>Table</span></a></h5><blockquote><p>关系型数据库中表的概念，不同的是，表声明时，只需要声明列族即可，不需要声明具体的列，因为数据存储时为稀疏的，字段可以动态指定，因此，Hbase 更能应对字段变更的场景</p></blockquote><h5 id="row" tabindex="-1"><a class="header-anchor" href="#row"><span>Row</span></a></h5><blockquote><p>Hbase表中每行数据都有一个RowKey 和 多个 Column组成，数据时按照RwoKey的字典序顺序存储，并且查询数据时，只能根据RowKey进行检索，所以RwoKey的存储十分重要</p></blockquote><h5 id="column" tabindex="-1"><a class="header-anchor" href="#column"><span>Column</span></a></h5><blockquote><p>Hbase每个列都由<code>Column Family(列族)</code> 和 <code>Column Qualifier（列名）</code>进行限定，如：info:name，info:age,建表时，只需要指定列族即可</p></blockquote><h5 id="time-stamp" tabindex="-1"><a class="header-anchor" href="#time-stamp"><span>Time Stamp</span></a></h5><p>用户标识不同版本，每条数据写入时，系统会自动增加该字段</p><h5 id="cell" tabindex="-1"><a class="header-anchor" href="#cell"><span>Cell</span></a></h5><p>数据上的value值，由<code>{rowkey,column Family:column Qualifier,timestamp}</code>唯一确定的单元，cell中的数据，全是字节码形式存储</p><h3 id="基本架构" tabindex="-1"><a class="header-anchor" href="#基本架构"><span>基本架构</span></a></h3><p><img src="/blog/Hbase.assets/image-20221214171119216.png" alt="image-20221214171119216"></p><h4 id="架构角色" tabindex="-1"><a class="header-anchor" href="#架构角色"><span>架构角色</span></a></h4><h5 id="zookeeper" tabindex="-1"><a class="header-anchor" href="#zookeeper"><span>Zookeeper</span></a></h5><blockquote><ul><li>Hbase 通过 zookeeper 来实现master的高可用，记录RegionServer 的部署信息，并且存储所有表的位置信息</li><li>Hbase对于数据的读写操作，都需要先访问 zookeeper，获取到表所在的regionServer，然后进行通信</li></ul></blockquote><h5 id="master" tabindex="-1"><a class="header-anchor" href="#master"><span>Master</span></a></h5><blockquote><p>负责监控集群中所有的<code>regionServer</code>实例，主要作用如下：</p><ul><li>管理元数据表格：hbase:meta，接收用户对表格ddl操作命令，并执行</li><li>监控Region是否需要进行负载均衡，故障转移和region的拆分，通过启动多个后台线程来实现上述功能 <ul><li>LoadBlance：负载均衡器 <ul><li>周期性的监控region 在regionServer上面的分布是否均衡</li></ul></li><li>CatalogJanitor：元数据管理器 <ul><li>定期检查和清理hbase:meta中的数据，</li></ul></li><li>MasterProWAL master 预写日志处理器 <ul><li>将master需要执行的任务，记录到预写日志WAL中（HDFS），如果master宕机，则由backupMaster读取日志，继续执行</li></ul></li></ul></li></ul></blockquote><h5 id="region-server" tabindex="-1"><a class="header-anchor" href="#region-server"><span>Region Server</span></a></h5><blockquote><ul><li>负责cell数据的处理，例如数据写入 put，数据查询 get 等</li><li>拆分合并 region的实际执行者，由master监控，由regionServer实际执行</li></ul></blockquote><h5 id="region" tabindex="-1"><a class="header-anchor" href="#region"><span>Region</span></a></h5><blockquote><ul><li>类似mysql表中横向切分，每个region 维护 startRowKey ~ stopRowKey 范围内的数据</li><li>当内部数据达到拆分条件时，会自动拆分</li></ul></blockquote><h5 id="store" tabindex="-1"><a class="header-anchor" href="#store"><span>Store</span></a></h5><blockquote><ul><li>Region 下，会按照列族拆分存储数据，每个列族就是一个Store</li><li>Hfile 为真实存储数据的文件</li></ul></blockquote><h2 id="快速入门" tabindex="-1"><a class="header-anchor" href="#快速入门"><span>快速入门</span></a></h2><h3 id="安装部署" tabindex="-1"><a class="header-anchor" href="#安装部署"><span>安装部署</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># 因依赖框架较多，流程复杂，目前先使用docker方式安装，切记暴露所有的端口，否则javaApi可能连接不成功</span></span>
<span class="line"><span class="token comment"># 目前部署地址：http://172.23.4.32:16011/master-status</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="hbase-shell" tabindex="-1"><a class="header-anchor" href="#hbase-shell"><span>HBase-shell</span></a></h3><h4 id="ddl" tabindex="-1"><a class="header-anchor" href="#ddl"><span>DDL</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="line"><span class="token comment"># 链接shell</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token operator">/</span>bin<span class="token operator">/</span>hbase shell</span>
<span class="line"><span class="token comment"># 查看帮助</span></span>
<span class="line">help</span>
<span class="line"><span class="token comment"># 查看创建命名空间帮助</span></span>
<span class="line">help <span class="token string">&#39;create_namespace&#39;</span></span>
<span class="line"><span class="token comment"># 查看 所有 namespace</span></span>
<span class="line">create_namespace <span class="token string">&#39;test&#39;</span></span>
<span class="line">list_namespace</span>
<span class="line"><span class="token comment"># 创建表,namespace:table,列族1 =&gt; 保留版本,列族2 =&gt; 保留版本</span></span>
<span class="line"><span class="token keyword">create</span> <span class="token string">&#39;student&#39;</span><span class="token punctuation">,</span> {NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;info&#39;</span><span class="token punctuation">,</span> VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">5</span>}<span class="token punctuation">,</span> {NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;company&#39;</span><span class="token punctuation">,</span> VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">5</span>}</span>
<span class="line"><span class="token comment"># 查看表结构</span></span>
<span class="line"><span class="token keyword">describe</span> <span class="token string">&#39;test:student&#39;</span></span>
<span class="line"><span class="token comment"># 禁用表</span></span>
<span class="line"><span class="token keyword">disable</span> <span class="token string">&#39;test:student&#39;</span></span>
<span class="line"><span class="token comment"># 删除表</span></span>
<span class="line"><span class="token keyword">drop</span> <span class="token string">&#39;test:student&#39;</span></span>
<span class="line"><span class="token comment"># 修改表</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token string">&#39;test:student&#39;</span><span class="token punctuation">,</span>{NAME <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;company&#39;</span><span class="token punctuation">,</span> VERSIONS <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;3&#39;</span>}</span>
<span class="line"><span class="token comment"># 删除表字段</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token string">&#39;test:student1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;delete&#39;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;f1&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="dml" tabindex="-1"><a class="header-anchor" href="#dml"><span>DML</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="line"><span class="token comment"># 插入数据 ,重复插入会一直覆盖，保留多个版本</span></span>
<span class="line"><span class="token comment"># put &#39;ns1:t1&#39;, &#39;r1&#39;, &#39;c1&#39;, &#39;value&#39;</span></span>
<span class="line">put <span class="token string">&#39;test:student&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1001&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;info:age&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;12&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取数据，通过 rowKey</span></span>
<span class="line"><span class="token comment"># get &#39;ns1:t1&#39;, &#39;r1&#39;</span></span>
<span class="line"><span class="token comment"># get &#39;t1&#39;, &#39;r1&#39;, {COLUMN =&gt; [&#39;c1&#39;, &#39;c2&#39;, &#39;c3&#39;]}</span></span>
<span class="line">get <span class="token string">&#39;test:student&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1001&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 扫描数据,后面都是可选参数</span></span>
<span class="line"><span class="token comment"># scan &#39;ns1:t1&#39;, {COLUMNS =&gt; [&#39;c1&#39;, &#39;c2&#39;], LIMIT =&gt; 10, STARTROW =&gt; &#39;xyz&#39;,STOPROW =&gt; &#39;&#39;}</span></span>
<span class="line"><span class="token comment"># 注意：STARTROW 为 闭区间，STOPROW 为开区间，不包含此值</span></span>
<span class="line">scan <span class="token string">&#39;dmp_order_202303&#39;</span><span class="token punctuation">,</span> {<span class="token keyword">COLUMNS</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&#39;custom:orderid&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> STARTROW <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;1001&#39;</span><span class="token punctuation">,</span>STOPROW <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;1004&#39;</span>}</span>
<span class="line"><span class="token comment"># 指定字段过滤</span></span>
<span class="line">scan <span class="token string">&#39;dmp_order_202304&#39;</span><span class="token punctuation">,</span> {<span class="token keyword">COLUMNS</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&#39;custom:orderId&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;campaign:sdk_package_id&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> STARTROW <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;50471701683244813&#39;</span><span class="token punctuation">,</span>STOPROW <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;50471701683241213&#39;</span><span class="token punctuation">,</span>FILTER<span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">&quot;SingleColumnValueFilter(&#39;campaign&#39;,&#39;sdk_package_id&#39;,=,&#39;binary:53475983&#39;)&quot;</span>}</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 删除数据</span></span>
<span class="line"><span class="token comment"># 删除一个版本：delete &#39;ns1:t1&#39;, &#39;r1&#39;, &#39;c1&#39;, ts1，删除后再次get，获取到的就是上一个版本</span></span>
<span class="line"><span class="token keyword">delete</span> <span class="token string">&#39;test:student&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1001&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;info:age&#39;</span></span>
<span class="line"><span class="token comment"># 删除所有版本：deleteall &#39;ns1:t1&#39;, &#39;r1&#39;</span></span>
<span class="line">deleteall <span class="token string">&#39;test:student&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1001&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;info:age&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="api使用" tabindex="-1"><a class="header-anchor" href="#api使用"><span>API使用</span></a></h2><h4 id="connection介绍" tabindex="-1"><a class="header-anchor" href="#connection介绍"><span>connection介绍：</span></a></h4><p><strong>很多初次使用connection的小伙伴，受其他数据库的影响，可能会陷入以下几个误区：</strong></p><ol><li>封装连接池，每次使用，从连接池中获取一个</li><li>多线程使用时，每个线程持有一个connection链接对象</li><li>每次访问Hbase时，临时创建connection对象，使用完成后调用close方法，关闭链接</li></ol><p><strong>参考Hbase技术社区文章发现：</strong></p><ol><li>HBase客户端中的connection对象并不是简单对应一个socket连接</li><li>HBase客户端的connection包含了对Zookeeper、HBase Master、HBase RegionServer三种socket连接的封装。因此，connection对象每次被创建出来的开销是很大的，使用完毕之后断开，会带来严重的性能损耗。</li><li>在HBase中connection类已经实现了对连接的管理功能，所以我们不需要自己在connection之上再做额外的管理。另外，connection是线程安全的，而Table和Admin则不是线程安全的，因此正确的做法是，在一个JVM进程中共用一个connection对象，而在不同的线程中使用单独的Table和Admin对象。</li></ol><h4 id="ddl-1" tabindex="-1"><a class="header-anchor" href="#ddl-1"><span>DDL</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoDdl</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">HbaseUtil</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Admin</span> admin <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">getAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> namespace <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> tableName <span class="token operator">=</span> <span class="token string">&quot;student&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 创建namespace</span></span>
<span class="line">        <span class="token function">createNamespace</span><span class="token punctuation">(</span>admin<span class="token punctuation">,</span> namespace<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 打印namespace</span></span>
<span class="line">        <span class="token function">printNamespace</span><span class="token punctuation">(</span>admin<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 创建表</span></span>
<span class="line">        <span class="token function">createTable</span><span class="token punctuation">(</span>admin<span class="token punctuation">,</span> tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 打印table详情</span></span>
<span class="line">        <span class="token function">printTableDescribe</span><span class="token punctuation">(</span>admin<span class="token punctuation">,</span> tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 修改表</span></span>
<span class="line">        <span class="token function">updateTable</span><span class="token punctuation">(</span>admin<span class="token punctuation">,</span> tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 打印table详情</span></span>
<span class="line">        <span class="token function">printTableDescribe</span><span class="token punctuation">(</span>admin<span class="token punctuation">,</span> tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        admin<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">HbaseUtil</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">updateTable</span><span class="token punctuation">(</span><span class="token class-name">Admin</span> admin<span class="token punctuation">,</span> <span class="token class-name">String</span> tableName<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">TableName</span> oldTable <span class="token operator">=</span> <span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>admin<span class="token punctuation">.</span><span class="token function">tableExists</span><span class="token punctuation">(</span>oldTable<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;table not exists&quot;</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token class-name">TableDescriptor</span> descriptor <span class="token operator">=</span> admin<span class="token punctuation">.</span><span class="token function">getDescriptor</span><span class="token punctuation">(</span>oldTable<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">TableDescriptorBuilder</span> builder <span class="token operator">=</span> <span class="token class-name">TableDescriptorBuilder</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        builder<span class="token punctuation">.</span><span class="token function">modifyColumnFamily</span><span class="token punctuation">(</span><span class="token class-name">ColumnFamilyDescriptorBuilder</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMaxVersions</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        admin<span class="token punctuation">.</span><span class="token function">modifyTable</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printTableDescribe</span><span class="token punctuation">(</span><span class="token class-name">Admin</span> admin<span class="token punctuation">,</span> <span class="token class-name">String</span> tableName<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">TableDescriptor</span> descriptor <span class="token operator">=</span> admin<span class="token punctuation">.</span><span class="token function">getDescriptor</span><span class="token punctuation">(</span><span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;table----&quot;</span> <span class="token operator">+</span> descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTable</span><span class="token punctuation">(</span><span class="token class-name">Admin</span> admin<span class="token punctuation">,</span> <span class="token class-name">String</span> tableName<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">TableName</span> name <span class="token operator">=</span> <span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>admin<span class="token punctuation">.</span><span class="token function">tableExists</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token class-name">TableDescriptorBuilder</span> builder <span class="token operator">=</span> <span class="token class-name">TableDescriptorBuilder</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        builder<span class="token punctuation">.</span><span class="token function">setColumnFamily</span><span class="token punctuation">(</span><span class="token class-name">ColumnFamilyDescriptorBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        builder<span class="token punctuation">.</span><span class="token function">setColumnFamily</span><span class="token punctuation">(</span><span class="token class-name">ColumnFamilyDescriptorBuilder</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        admin<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createNamespace</span><span class="token punctuation">(</span><span class="token class-name">Admin</span> admin<span class="token punctuation">,</span> <span class="token class-name">String</span> namespace<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">NamespaceDescriptor</span> test <span class="token operator">=</span> <span class="token class-name">NamespaceDescriptor</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>namespace<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">NamespaceDescriptor</span> test1 <span class="token operator">=</span> admin<span class="token punctuation">.</span><span class="token function">getNamespaceDescriptor</span><span class="token punctuation">(</span>namespace<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>test1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            admin<span class="token punctuation">.</span><span class="token function">createNamespace</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printNamespace</span><span class="token punctuation">(</span><span class="token class-name">Admin</span> admin<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">NamespaceDescriptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> namespaceDescriptors <span class="token operator">=</span> admin<span class="token punctuation">.</span><span class="token function">listNamespaceDescriptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">NamespaceDescriptor</span> namespaceDescriptor <span class="token operator">:</span> namespaceDescriptors<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>namespaceDescriptor<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HbaseUtil</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Connection</span> <span class="token constant">CONNECTION</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">static</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Configuration</span> configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        configuration<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;hbase.zookeeper.quorum&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;172.23.4.33:12181&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// configuration.set(&quot;hbase.zookeeper.property.clientPort&quot;, &quot;12181&quot;);</span></span>
<span class="line">        <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token constant">CONNECTION</span> <span class="token operator">=</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span>configuration<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token constant">CONNECTION</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">IoUtil</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token constant">CONNECTION</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="dml-1" tabindex="-1"><a class="header-anchor" href="#dml-1"><span>DML</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoDml</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">HbaseUtil</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">TableName</span> student <span class="token operator">=</span> <span class="token class-name">TableName</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token string">&quot;student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Table</span> table <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">getTable</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> rowKey <span class="token operator">=</span> <span class="token string">&quot;1001&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 添加数据</span></span>
<span class="line">        <span class="token function">insertData</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> rowKey<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// get查询</span></span>
<span class="line">        <span class="token function">getData</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> rowKey<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// scan查询</span></span>
<span class="line">        <span class="token function">scanData</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 关闭链接</span></span>
<span class="line">        table<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">HbaseUtil</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">scanData</span><span class="token punctuation">(</span><span class="token class-name">Table</span> table<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Scan</span> scan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        scan<span class="token punctuation">.</span><span class="token function">addFamily</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//  设置startRowKey</span></span>
<span class="line">        scan<span class="token punctuation">.</span><span class="token function">withStartRow</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;1001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//  设置stopRowKey</span></span>
<span class="line">        scan<span class="token punctuation">.</span><span class="token function">withStopRow</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;1005&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 设置过滤器条件</span></span>
<span class="line">        <span class="token class-name">FilterList</span> filterList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilterList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 单个字段比较</span></span>
<span class="line">        <span class="token class-name">SingleColumnValueFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SingleColumnValueFilter</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">CompareOperator</span><span class="token punctuation">.</span><span class="token constant">EQUAL</span><span class="token punctuation">,</span> <span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;1004&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        filterList<span class="token punctuation">.</span><span class="token function">addFilter</span><span class="token punctuation">(</span>filter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        scan<span class="token punctuation">.</span><span class="token function">setFilter</span><span class="token punctuation">(</span>filterList<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">ResultScanner</span> scanner <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">getScanner</span><span class="token punctuation">(</span>scan<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Result</span> result <span class="token operator">:</span> scanner<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Cell</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cells <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">rawCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cell</span> cell <span class="token operator">:</span> cells<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneRow</span><span class="token punctuation">(</span>cell<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;---&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneFamily</span><span class="token punctuation">(</span>cell<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token operator">+</span> <span class="token string">&quot;---&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneQualifier</span><span class="token punctuation">(</span>cell<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                        <span class="token operator">+</span> <span class="token string">&quot;---&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>cell<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@SneakyThrows</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">Table</span> table<span class="token punctuation">,</span> <span class="token class-name">String</span> rowKey<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Get</span> get <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Get</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span>rowKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Result</span> result <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>get<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Cell</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cells <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">rawCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cell</span> cell <span class="token operator">:</span> cells<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">CellUtil</span><span class="token punctuation">.</span><span class="token function">cloneValue</span><span class="token punctuation">(</span>cell<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">insertData</span><span class="token punctuation">(</span><span class="token class-name">Table</span> table<span class="token punctuation">,</span> <span class="token class-name">String</span> rowKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> a <span class="token operator">:</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1004</span><span class="token punctuation">,</span> <span class="token number">1002</span><span class="token punctuation">,</span> <span class="token number">1003</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token class-name">Delete</span> delete <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Delete</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            table<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>delete<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token class-name">Put</span> put <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Put</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            put<span class="token punctuation">.</span><span class="token function">addColumn</span><span class="token punctuation">(</span><span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Bytes</span><span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            table<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>put<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="原理进阶" tabindex="-1"><a class="header-anchor" href="#原理进阶"><span>原理进阶</span></a></h2><h3 id="master-1" tabindex="-1"><a class="header-anchor" href="#master-1"><span>Master</span></a></h3><blockquote><p>主要进程，具体实现类是<code>HMaster</code>，通常部署在<code>namenode</code>上</p></blockquote><p>负载均衡：通过读取meata表，了解Region 的分配，通过ZK了解Region Server的节点状态，5分钟调控一次，分配均衡</p><ul><li>meta表，本质上和Hbase的其他表格相同 <img src="/blog/Hbase.assets/image-20221214164053080.png" alt="image-20221214164053080"><img src="/blog/Hbase.assets/image-20221214164134193.png" alt="image-20221214164134193"><ul><li>RowKey：table,region start key,region id（表名，region的起始rowKey和regionID）</li><li>info：regioninfo 为region 信息，存储一个HRegionInfo对象</li><li>info：server 为当前region 所处的<code>RegionServer</code> 信息，包含端口号</li><li>info：serverstartcode 为当前region被分到RegionServer的起始时间</li></ul></li><li>元数据表管理：存储在Hdfs上，元数据表路径：<code>/hbase/data/hbase/meta</code></li><li>MasterProcWAL：管理Master自己的预写日志，如果宕机后，让BackUpMaster读取日志数据，继续执行命令，本质写数据到HDFS，32M或1H滚动，当操作执行到meta表之后删除WAL，WAL数据文件路径：<code>/hbase/MasterData/WALs</code></li><li>客户端在对元数据进行操作的时间才会连接master，如果对数据进行读写，直接链接zk，读取目录<code>/hbase/meta-region-server</code>节点信息，会记录meta表格的位置，直接读取即可，不需要访问master，可以减轻master的压力</li></ul><h3 id="region-server-1" tabindex="-1"><a class="header-anchor" href="#region-server-1"><span>Region Server</span></a></h3><blockquote><p>主要进程，具体实现类为<code>HRegionServer</code>，通常部署在 <code>dataNode</code> 上</p></blockquote><p><img src="/blog/Hbase.assets/image-20221215102036139.png" alt="image-20221215102036139"></p><h4 id="memstore" tabindex="-1"><a class="header-anchor" href="#memstore"><span>MemStore</span></a></h4><blockquote><p>写入缓存，由于HFile中的数据要求为有序的，所以数据时优先存储在内存MemStore中，排序完成后，达到刷写时机，才会写入到HFile中，每次刷写会形成一个新的HFile，写入到对应的文件夹store中</p></blockquote><h4 id="wal" tabindex="-1"><a class="header-anchor" href="#wal"><span>WAL</span></a></h4><blockquote><p>由于数据在MemStore中，需要存储一段时间才会持久化，为保证数据不丢失，数据会首先写入到Hdfs 路径下，在写入到MemStore中，当系统出现故障重启后，会从Hdfs路径下进行恢复</p></blockquote><h4 id="blockcache" tabindex="-1"><a class="header-anchor" href="#blockcache"><span>BlockCache</span></a></h4><blockquote><p>读缓存，每次查询的数据会缓存，方便下次的查询</p></blockquote><h3 id="数据写入流程" tabindex="-1"><a class="header-anchor" href="#数据写入流程"><span>数据写入流程</span></a></h3><p>写入流程如下图所示：</p><p><img src="/blog/Hbase.assets/image-20221216102421800.png" alt="image-20221216102421800"></p><blockquote><p>在数据写入到 <code>Mem Story</code> 后，就会跟客户端响应 <code>ACK</code></p></blockquote><h5 id="memstore-flush" tabindex="-1"><a class="header-anchor" href="#memstore-flush"><span>MemStore flush</span></a></h5><blockquote><p>数据刷盘</p></blockquote><ul><li>当某个MemStore 大小达到(hbase.hregion.memstore.flush.size（默认值 128M))，其所在region的所有MemStore都会刷盘</li><li>当regionServer中，memStore 的总大小达到低水位线，会按照所有memeStore的大小顺序，由大到小进行刷写，直到regionServer中所有的memstore的总大小减少到这个值以下 <ul><li>regionServer中 MemStore的总大小：hbase.regionserver.global.memstore.size（默认值0.4）</li><li>低水位：达到MemStore总大小的：95%，通过参数设置：hbase.regionserver.global.memstore.size.lower.limit（默认值0.95)</li><li>高水位：达到MemStore的总大小，100%，会阻止往所有的MemStore中写入数据</li></ul></li><li>时间条件，避免数据长时间处于内存中，5min刷新一次</li><li>当WAL文件的数据量超过<code>hbase.regionserver.max.logs</code>，也会执行刷写，直到数据量减小为 32</li></ul><h3 id="数据读取流程" tabindex="-1"><a class="header-anchor" href="#数据读取流程"><span>数据读取流程：</span></a></h3><h4 id="hfile" tabindex="-1"><a class="header-anchor" href="#hfile"><span>HFile：</span></a></h4><blockquote><p>HFile 就是最终Region下存储的 store 数据，也就是要读取查询的数据</p><ul><li>每个Hfile还会维护一个布隆过滤器，get 查询的时候可以判断某个RowKey是否存储在当前File下</li></ul><p>可以通过下面命令查看HDFS 上存储的 Hfile的具体信息</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># ./bin/hbase hfile -m -f /hbase/data/{namespace}/{table}/{regionId}/{列族}/{HFile文件名称}</span></span>
<span class="line">./bin/hbase hfile <span class="token parameter variable">-m</span> <span class="token parameter variable">-f</span> /adt_hbase/data/default/dmp_install_202211/1f972f37d3a24c96e3bb8840b5ca0943/campaign/fb7293e3b3294a2eb3f207f7c8bc32e4</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h4 id="读流程" tabindex="-1"><a class="header-anchor" href="#读流程"><span>读流程</span></a></h4><p><img src="/blog/Hbase.assets/image-20221216102443647.png" alt="image-20221216102443647"><u></u></p><blockquote><p>不管第6步是否能够读取到数据，都会进行第7步读取，因为缓存中的数据可能不是最新的，最终会将读取到的所有数据，合并版本，按照get的要求返回即可</p></blockquote><h4 id="合并读取优化" tabindex="-1"><a class="header-anchor" href="#合并读取优化"><span>合并读取优化</span></a></h4><p>每次读取数据都需要读取三个位置，最后进行版本的合并。效率会非常低，所有系统需要对此优化。</p><ul><li>HFile带有索引文件，读取对应的RowKey数据会比较快</li><li>Block Cache 会缓存之前读取的内容和元数据信息，如果HFile没有发生变化(记录在HFile尾信息中)，则不需要再次读取</li><li>HFile外面有一层布隆过滤器，能够快速判断当前RowKey的数据是否在当前文件中，不存在则不用继续读取数据</li></ul><h3 id="storefile-compaction" tabindex="-1"><a class="header-anchor" href="#storefile-compaction"><span>StoreFile Compaction：</span></a></h3><blockquote><p>每次MemStore刷写，都会生成一个新的HFile，文件过多读取不方便，所以会进行文件的合并，清理掉过期和删除的数据，会进行StoreFile Compaction</p><p>Compaction分为两种，分别是<code>Minor Compaction</code> 和 <code>Major Compaction</code></p><ul><li><strong>Minor Compaction</strong> 是指选取一些小的、相邻的StoreFile将他们合并成一个更大的StoreFile，在这个过程中不会处理已经Deleted或Expired的Cell。一次Minor Compaction的结果是更少并且更大的StoreFile</li><li><strong>Major Compaction</strong> 是指将所有的StoreFile合并成一个StoreFile，这个过程还会清理三类无意义数据：被删除的数据、TTL过期数据、版本号超过设定版本号的数据。MajorCompaction 时对系统的压力还是很大的，所以建议关闭自动MajorCompaction，采用手动触发的方式，定期进行 MajorCompaction</li></ul></blockquote><p><img src="/blog/Hbase.assets/image-20221215120226253.png" alt="image-20221215120226253"></p><h3 id="region-split" tabindex="-1"><a class="header-anchor" href="#region-split"><span>Region Split</span></a></h3><blockquote><p>每个region都是有 <code>startRowKey</code> 和 <code>endRowKey</code> ，插入数据时，根据当前数据的rowKey，找到负责管理的region</p><p>Region切分规则</p><ul><li>自定义分区</li><li>可以将数据所要投放的分区提前大致的规划好，以提高HBase的性能，类似HashMap提前指定大小，防止扩容带来的性能问题</li><li>系统默认的切分规则，避免单个Region的数据量过大</li></ul></blockquote><h4 id="自定义分区" tabindex="-1"><a class="header-anchor" href="#自定义分区"><span>自定义分区</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># splits </span></span>
<span class="line"><span class="token comment"># create &#39;ns1:t1&#39;, &#39;f1&#39;, SPLITS =&gt; [&#39;10&#39;, &#39;20&#39;, &#39;30&#39;, &#39;40&#39;]</span></span>
<span class="line">create <span class="token string">&#39;score&#39;</span>,<span class="token string">&#39;info&#39;</span>,SPLITS<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&#39;10&#39;</span>, <span class="token string">&#39;20&#39;</span>, <span class="token string">&#39;30&#39;</span>, <span class="token string">&#39;40&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/Hbase.assets/image-20221216101710212.png" alt="image-20221216101710212"></p><h4 id="系统拆分" tabindex="-1"><a class="header-anchor" href="#系统拆分"><span>系统拆分</span></a></h4><blockquote><p>Region的拆分是由HRegionServer完成的</p><p>2.0版本之后 =&gt; SteppingSplitPolicy</p><ul><li>如果当前RegionServer上该表只有1个Region，则按照阈值为 2 * <code>hbase.hregion.memstore.flush.size(128M)</code>分裂，否则按照 <code>hbase.hregion.max.filesize(10G)</code>分裂</li></ul></blockquote><h2 id="优化使用" tabindex="-1"><a class="header-anchor" href="#优化使用"><span>优化使用</span></a></h2><h3 id="rowkey设计" tabindex="-1"><a class="header-anchor" href="#rowkey设计"><span>RowKey设计</span></a></h3><blockquote><ul><li>数据存储于哪个分区，取决于rowkey处于哪个region的分区范围内，所以rowkey的设计，目的也是为了让数据均匀的分布在不同的region上，一定程度上防止数据倾斜</li><li>hbase的查询，必须依赖rowKey，所以好的rowkey设计，可以在查询时，扫描更小的数据范围，效率更高</li></ul></blockquote><h4 id="常用的设计方式" tabindex="-1"><a class="header-anchor" href="#常用的设计方式"><span>常用的设计方式</span></a></h4><ul><li>生成随机数、hash、散列值</li><li>时间戳反转（默认rowKey按正序排列，但实际中最新的数据是会频繁读写查询的）</li><li>字符串拼接</li></ul><h3 id="demo" tabindex="-1"><a class="header-anchor" href="#demo"><span>Demo</span></a></h3><blockquote><p>有以下用户数据：如何设计rowKey，可以方便的实现需求的快速查询</p></blockquote><p><img src="/blog/Hbase.assets/image-20221216110931369.png" alt="image-20221216110931369"></p><p><strong>需求一：统计张三在2021年12月份消费的总金额</strong></p><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="line"><span class="token comment"># rowKey：格式：user + date =&gt; zhangsan2022-01-04 09:08:00</span></span>
<span class="line"><span class="token comment"># 日期的月份日期的下一位为：-，startRow 闭区间，stopRow为开区间，所以找到ascii中，「-」的下一位「.」</span></span>
<span class="line"><span class="token key attr-name">scan</span> <span class="token value attr-value">&#39;order&#39;,{STARTROW=&gt;&#39;zhangsan2021-12&#39;,STOPROW=&gt;&#39;zhangsan2021-12.&#39;}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/Hbase.assets/image-20221216114414110.png" alt="image-20221216114414110"></p><p><strong>需求2：统计所有人在2021年12月份消费的总金额</strong></p><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="line"><span class="token comment"># RowKey设计格式：date + user =&gt; 2022-01-04 09:08:00zhangsanfeng</span></span>
<span class="line"><span class="token key attr-name">scan</span> <span class="token value attr-value">&#39;order&#39;,{STARTROW=&gt;&#39;2021-12&#39;,STOPROW=&gt;&#39;2021-12.&#39;}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>需求3：同时满足需求1+需求2的设计</strong></p><blockquote><p>调整的原则：可枚举的放在前面</p></blockquote><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="line"><span class="token comment"># RowKey设计格式：yyyyMM + user + dd HH:mm:ss</span></span>
<span class="line"><span class="token comment"># 2022-01zhangsanfeng-04 09:08:00</span></span>
<span class="line"><span class="token comment"># **需求一：统计张三在2021年12月份消费的总金额**</span></span>
<span class="line"><span class="token key attr-name">scan</span> <span class="token value attr-value">&#39;order&#39;,{STARTROW=&gt;&#39;2021-12zhangsan&#39;,STOPROW=&gt;&#39;2021-12zhangsan.&#39;}</span></span>
<span class="line"><span class="token comment"># 需求2：统计所有人在2021年12月份消费的总金额</span></span>
<span class="line"><span class="token key attr-name">scan</span> <span class="token value attr-value">&#39;order&#39;,{STARTROW=&gt;&#39;2021-12&#39;,STOPROW=&gt;&#39;2021-12.&#39;}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="预分区优化" tabindex="-1"><a class="header-anchor" href="#预分区优化"><span>预分区优化</span></a></h3><blockquote><p>预分区优化，同样要遵守rowKey的scan原则，rowKey的最前面部分，用作定位分区</p><p>现有系统的处理逻辑：每个月一张表，且每张表 9个分区</p></blockquote><p><img src="/blog/Hbase.assets/image-20221216130059810.png" alt="image-20221216130059810"></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">buildBorderRow</span><span class="token punctuation">(</span><span class="token class-name">Long</span> pid<span class="token punctuation">,</span> <span class="token class-name">Long</span> time<span class="token punctuation">,</span> <span class="token class-name">String</span> appKey<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 首位为分区号</span></span>
<span class="line">  <span class="token keyword">return</span>  <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span> <span class="token function">computePartitionCode</span><span class="token punctuation">(</span>appKey<span class="token punctuation">)</span> <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>  <span class="token function">formatLong</span><span class="token punctuation">(</span> pid<span class="token punctuation">,</span> <span class="token constant">PRODUCT_ID_FORMAT</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span> time <span class="token operator">/</span> <span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span> <span class="token function">computePartitionCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> appKey<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// appkey 的hashCode % 分区数</span></span>
<span class="line">  <span class="token keyword">byte</span> partition<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>appKey<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token constant">PARTITION_NUM</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> partition<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参数优化" tabindex="-1"><a class="header-anchor" href="#参数优化"><span>参数优化</span></a></h2><ul><li>超时时间</li><li>手动控制 major merge</li><li>优化 HStore 文件大小</li><li>优化HBase客户端缓存 <ul><li>默认：2M</li></ul></li><li>指定scan.next 扫描Hbase所获取的行数 <ul><li>默认int的maxValue （21亿）</li></ul></li><li>RegionServer中的读写缓存 0.4</li><li>lars Hofhansl （拉斯·霍夫汉斯）推荐：region设置为20G，刷写大小设置为128M（默认如此），其他默认</li></ul><h2 id="jvm调优" tabindex="-1"><a class="header-anchor" href="#jvm调优"><span>JVM调优</span></a></h2><blockquote><p>防患于未然，早洗澡轻松</p></blockquote><ul><li>设置CMS收集器（并发垃圾回收）</li><li>保证新生代尽量小，尽早开启GC <ul><li>70%回收</li><li>减小新生代大小</li></ul></li><li>清理的都是读缓存</li></ul><h2 id="hbase使用经验法则" tabindex="-1"><a class="header-anchor" href="#hbase使用经验法则"><span>Hbase使用经验法则</span></a></h2><ul><li>Region大小控制 10 - 50G，默认10G</li><li>cell大小不要超过 100K，某则切换为mob类型</li><li>1张表，有1~3个列族，不要设计太多，最好就1个，如果使用多个，尽量保证不会同事读取多个列族</li><li>1到2个列族的表格，设计 10~100个Region <ul><li>每个region都有自己的写缓存</li></ul></li><li>列族的名称尽量短，不用模仿RDBMS数据库</li><li>如果RowKey设计，时间在最前面，会导致有大量的旧数据存储在不活跃的Region中，使用的时候，仅仅会操作少数的活动Region，建议增加更多的Region个数</li><li>如果只有一个列族用于写入数据，分配内存资源的时候可以做出调整，即写缓存不会占用太多的内存</li></ul><h2 id="phoenix简介" tabindex="-1"><a class="header-anchor" href="#phoenix简介"><span>Phoenix简介</span></a></h2><blockquote><p>是HBase的开源SQL提供，可以使用标准的JDBC API 代替HBase客户端API来创建表，插入数据和查询Hbase数据</p></blockquote><h3 id="为什么使用" tabindex="-1"><a class="header-anchor" href="#为什么使用"><span>为什么使用？</span></a></h3><blockquote><p>不会减慢速度，而且会对sql有大量的优化手段</p></blockquote><h3 id="安装部署-1" tabindex="-1"><a class="header-anchor" href="#安装部署-1"><span>安装部署</span></a></h3><blockquote><p>phoenix.apache.org</p></blockquote><h3 id="已有表-创建映射" tabindex="-1"><a class="header-anchor" href="#已有表-创建映射"><span>已有表，创建映射</span></a></h3><blockquote><p>Create table ...</p><p>create view ....</p></blockquote><h3 id="数字存储到额问题" tabindex="-1"><a class="header-anchor" href="#数字存储到额问题"><span>数字存储到额问题</span></a></h3><blockquote><p>存在的问题</p></blockquote><p>JDBC-API连接</p><blockquote><p>Java 代码连接</p></blockquote><h3 id="二级索引" tabindex="-1"><a class="header-anchor" href="#二级索引"><span>二级索引：</span></a></h3><h4 id="全局索引" tabindex="-1"><a class="header-anchor" href="#全局索引"><span>全局索引</span></a></h4><h4 id="本地索引" tabindex="-1"><a class="header-anchor" href="#本地索引"><span>本地索引</span></a></h4><h2 id="集成hive" tabindex="-1"><a class="header-anchor" href="#集成hive"><span>集成Hive</span></a></h2></div></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->更新时间 10/18/2024, 7:03:33 AM<!--]--></span></span></div></footer><!----><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#hbase概述" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Hbase概述"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Hbase概述<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#数据模型" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="数据模型"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据模型<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#基本架构" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="基本架构"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->基本架构<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#快速入门" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="快速入门"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->快速入门<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#安装部署" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="安装部署"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->安装部署<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#hbase-shell" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="HBase-shell"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->HBase-shell<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#api使用" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="API使用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->API使用<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#原理进阶" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="原理进阶"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->原理进阶<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#master-1" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Master"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Master<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#region-server-1" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Region Server"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Region Server<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#数据写入流程" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="数据写入流程"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据写入流程<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#数据读取流程" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="数据读取流程："><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据读取流程：<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#storefile-compaction" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="StoreFile Compaction："><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->StoreFile Compaction：<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#region-split" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Region Split"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Region Split<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#优化使用" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="优化使用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->优化使用<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#rowkey设计" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="RowKey设计"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->RowKey设计<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#demo" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Demo"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Demo<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#预分区优化" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="预分区优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->预分区优化<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#参数优化" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="参数优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->参数优化<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#jvm调优" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="JVM调优"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->JVM调优<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#hbase使用经验法则" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Hbase使用经验法则"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Hbase使用经验法则<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#phoenix简介" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Phoenix简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Phoenix简介<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#为什么使用" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="为什么使用？"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->为什么使用？<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#安装部署-1" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="安装部署"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->安装部署<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#已有表-创建映射" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="已有表，创建映射"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->已有表，创建映射<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#数字存储到额问题" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="数字存储到额问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数字存储到额问题<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#二级索引" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="二级索引："><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->二级索引：<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/jishu/bigData/Hbase.html#集成hive" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="集成Hive"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->集成Hive<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-D6sLFLco.js" defer></script>
  </body>
</html>
