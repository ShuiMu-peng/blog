<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>rocketmq标签 | 水木</title><meta name="description" content="欢迎来到我的空间。">
    <link rel="preload" href="/blog/assets/style-BraDacIo.css" as="style"><link rel="stylesheet" href="/blog/assets/style-BraDacIo.css">
    <link rel="modulepreload" href="/blog/assets/app-B6K0T__V.js"><link rel="modulepreload" href="/blog/assets/index.html-0GHc2cMg.js">
    <link rel="prefetch" href="/blog/assets/index.html-DVWxlgcq.js" as="script"><link rel="prefetch" href="/blog/assets/kafka.html-DOKItB-c.js" as="script"><link rel="prefetch" href="/blog/assets/scheduler.html-Drp__yoa.js" as="script"><link rel="prefetch" href="/blog/assets/Hbase.html-DvZ58706.js" as="script"><link rel="prefetch" href="/blog/assets/flink-to-clickHouse.html-DBxdG-y6.js" as="script"><link rel="prefetch" href="/blog/assets/ES.html-B-0MHbOn.js" as="script"><link rel="prefetch" href="/blog/assets/Rocket.html-_nH3SeUB.js" as="script"><link rel="prefetch" href="/blog/assets/mysql.html-CtUzXauf.js" as="script"><link rel="prefetch" href="/blog/assets/Redisson.html-Bx6FAVFm.js" as="script"><link rel="prefetch" href="/blog/assets/redis.html-CmvfnVrM.js" as="script"><link rel="prefetch" href="/blog/assets/Zookeeper.html-E7k0hsdB.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-D3ew3pPH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C-TNVO7u.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DJkMpyD6.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DZlQ2OIp.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BEyGzpjh.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CHIkBikE.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bio7xUaL.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CmcSPK7G.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BlebrQak.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BNc27vfx.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Ecd0iGwe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DWlVt83P.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-aJVo2Oli.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-udISkAL3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-uTUzK7xS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BJr_NcJc.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-KgIT-O3n.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DkPTyIOo.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-x1GFYEdj.js" as="script"><link rel="prefetch" href="/blog/assets/setupDevtools-7MC2TMWH-hcQrRGMC.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container no-sidebar external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/blog/"><img class="vp-site-logo" src="/blog/logo.jpg" alt="水木"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">水木</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/article/" aria-label="文章"><!---->文章<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/blog/tag/" aria-label="标签"><!---->标签<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/category/" aria-label="分类"><!---->分类<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/timeline/" aria-label="时间线"><!---->时间线<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/article/" aria-label="文章"><!---->文章<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/blog/tag/" aria-label="标签"><!---->标签<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/category/" aria-label="分类"><!---->分类<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/timeline/" aria-label="时间线"><!---->时间线<!----></a></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><div class="tag-wrapper"><!--[--><a href="/blog/tag/kafka/" class="tag" active="false">kafka <span class="tag-num">1</span></a><a href="/blog/tag/quartz/" class="tag" active="false">quartz <span class="tag-num">1</span></a><a href="/blog/tag/dolphinscheduler/" class="tag" active="false">dolphinScheduler <span class="tag-num">1</span></a><a href="/blog/tag/xxl-job/" class="tag" active="false">xxl-job <span class="tag-num">1</span></a><a href="/blog/tag/hbase/" class="tag" active="false">hbase <span class="tag-num">1</span></a><a href="/blog/tag/flink/" class="tag" active="false">flink <span class="tag-num">1</span></a><a href="/blog/tag/clickhouse/" class="tag" active="false">clickHouse <span class="tag-num">1</span></a><a href="/blog/tag/elasticsearch/" class="tag" active="false">elasticSearch <span class="tag-num">1</span></a><a href="/blog/tag/mq/" class="tag" active="false">mq <span class="tag-num">1</span></a><a aria-current="page" href="/blog/tag/rocketmq/" class="router-link-active router-link-exact-active tag" active="true">rocketmq <span class="tag-num">1</span></a><a href="/blog/tag/mysql/" class="tag" active="false">mysql <span class="tag-num">1</span></a><a href="/blog/tag/redis/" class="tag" active="false">Redis <span class="tag-num">2</span></a><a href="/blog/tag/redisson/" class="tag" active="false">Redisson <span class="tag-num">1</span></a><a href="/blog/tag/zookeeper/" class="tag" active="false">zookeeper <span class="tag-num">1</span></a><!--]--></div><div class="article-wrapper" data-v-310f94da><!----><!--[--><article class="article" data-v-310f94da><header class="title" data-v-310f94da>分布式调度框架调研</header><hr data-v-310f94da><div class="excerpt" data-v-310f94da><h2>quartz</h2>
<blockquote>
<p>参考资料：<a href="https://www.cnblogs.com/Dorae/p/9357180.html" target="_blank" rel="noopener noreferrer">Quartz原理解密 - Dorae - 博客园</a></p>
</blockquote>
<h3>架构图</h3>
<blockquote>
<p>去中心化设计，各个节点之间并无感知</p>
<p>通过 <code>mysql for update</code> 锁，保证任务不重复调用</p>
</blockquote>
<p><img src="/scheduler.assets/img.png" alt="image-20150519231230428"></p></div><div class="article-info" data-v-310f94da><span class="author" data-v-310f94da>shuiMu</span><span class="date" data-v-310f94da>2022-09-02</span><span class="category" data-v-310f94da>分类: 技术</span><span class="tag" data-v-310f94da>标签: quartz, dolphinScheduler, xxl-job</span></div></article><article class="article" data-v-310f94da><header class="title" data-v-310f94da>Hbase</header><hr data-v-310f94da><div class="excerpt" data-v-310f94da><h2>Hbase概述</h2>
<blockquote>
<p>Apache Hbase 是以HDFS存储的，一种分布式、可扩展的NoSql数据库</p>
</blockquote>
<h3>数据模型</h3>
<p>Hbase的设计理念，依据Google的BigTable论文（BigTable是一个<code>稀疏的</code>、<code>分布式的</code>、<code>持久的</code>多维排序map）</p>
<blockquote>
<p>map：<code>key-Value</code>，该映射，由行键、列键和时间戳索引；映射的每个值，都是一个未解释的字节数组（序列化后的byte）。</p>
</blockquote></div><div class="article-info" data-v-310f94da><span class="author" data-v-310f94da>shuiMu</span><span class="date" data-v-310f94da>2022-07-13</span><span class="category" data-v-310f94da>分类: 技术</span><span class="tag" data-v-310f94da>标签: hbase</span></div></article><article class="article" data-v-310f94da><header class="title" data-v-310f94da>Mysql</header><hr data-v-310f94da><div class="excerpt" data-v-310f94da><h2>查询过程</h2>
<p><img src="/mysql.assets/image-20230202085158769.png" alt="image-20230202085158769"></p>
<h2>事务</h2>
<h3>概念</h3>
<h5>事务ACID的特性：</h5>
<ul>
<li>原子性：同时成功，同时失败；由undo log 日志来实现</li>
<li>一致性：使用事务的最终目的；由其他三个特性以及业务代码正确逻辑来实现</li>
<li>持久性：一旦提交了事务，他对数据库的改变就是永久性的，持久性由redo log 日志来实现</li>
<li>隔离性：事务并发执行时，内部的操作不能相互干扰，隔离性由Mysql 的各种锁，MVCC机制来实现</li>
</ul></div><div class="article-info" data-v-310f94da><span class="author" data-v-310f94da>shuiMu</span><span class="date" data-v-310f94da>2022-07-13</span><span class="category" data-v-310f94da>分类: 技术</span><span class="tag" data-v-310f94da>标签: mysql</span></div></article><article class="article" data-v-310f94da><header class="title" data-v-310f94da>zookeeper</header><hr data-v-310f94da><div class="excerpt" data-v-310f94da><h2>Zookeeper</h2>
<blockquote>
<p>官网地址：https://zookeeper.apache.org/</p>
</blockquote>
<p>ZooKeeper本质上是一个分布式的小文件存储系统（Zookeeper=文件系统+监听机制）。提供基于类似于文件系统的目录树方式的数据存储，并且可以对树中的节点进行有效管理，从而用来维护和监控存储的数据的状态变化。通过监控这些数据状态的变化，从而可以达到基于数据的集群管理、统一命名服务、分布式配置管理、分布式消息队列、分布式锁、分布式协调等功能。</p>
<blockquote>
<p>Zookeeper从设计模式角度来理解：是一个基于观察者模式设计的分布式服务管理框架，它负责存储和管理大家都关心的数据，然后接受观察者的注册，一旦这些数据的状态发生变化，Zookeeper
就将负责通知已经在Zookeeper上注册的那些观察者做出相应的反应。</p>
</blockquote></div><div class="article-info" data-v-310f94da><span class="author" data-v-310f94da>shuiMu</span><span class="date" data-v-310f94da>2022-06-21</span><span class="category" data-v-310f94da>分类: 技术</span><span class="tag" data-v-310f94da>标签: zookeeper</span></div></article><article class="article" data-v-310f94da><header class="title" data-v-310f94da>Flink SQL 批模式下 ClickHouse 批量写入</header><hr data-v-310f94da><div class="excerpt" data-v-310f94da><blockquote>
<p>内置使用<code>JdbcBatchingOutputFormat</code> 批量处理类</p>
</blockquote>
<h5>pom依赖</h5>
<div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>ru.yandex.clickhouse<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>clickhouse-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.3.1-patch<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.flink<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>flink-connector-jdbc_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${flink.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${hutool.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${mysql.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="article-info" data-v-310f94da><span class="author" data-v-310f94da>shuiMu</span><span class="date" data-v-310f94da>2022-05-02</span><span class="category" data-v-310f94da>分类: 技术</span><span class="tag" data-v-310f94da>标签: flink, clickHouse</span></div></article><article class="article" data-v-310f94da><header class="title" data-v-310f94da>RocketMQ</header><hr data-v-310f94da><div class="excerpt" data-v-310f94da><h2>RocketMQ</h2>
<p>官网：
http://rocketmq.apache.org/docs/order-example/</p>
<blockquote>
<p>注意：</p>
<p>java中jar包版本 和 rocket 版本 保持一致，否则不能自动创建topic</p>
<p>大部分列子官网上已经存在，此处记录 出问题的一些点</p>
</blockquote>
<p>三个地方同步异步：</p>
<ul>
<li>主从</li>
<li>刷盘</li>
</ul>
<h3>常用的几种模式:</h3>
<ul>
<li>
<p>简单</p>
</li>
<li>
<p>有序：通过id或固定值，取模，添加到固定队列中；同一个队列中 消费是有序的</p>
</li>
<li>
<p>延时：</p>
<ol>
<li>先到延时队列中</li>
<li>到时间后才会存储到真正的队列中</li>
<li>org.apache.rocketmq.store.config.MessageStoreConfig#
messageDelayLevel = "1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h";</li>
</ol>
</li>
<li>
<p>过滤：通过 标签 或者 自定义属性进行 数据过滤展示</p>
<ul>
<li>如果开启属性过滤，需要设置：
开启 sql92 方式过滤:<code>enablePropertyFilter=true</code></li>
</ul>
</li>
<li>
<p>事务：</p>
</li>
</ul></div><div class="article-info" data-v-310f94da><span class="author" data-v-310f94da>shuiMu</span><span class="date" data-v-310f94da>2022-03-13</span><span class="category" data-v-310f94da>分类: 技术</span><span class="tag" data-v-310f94da>标签: mq, rocketmq</span></div></article><article class="article" data-v-310f94da><header class="title" data-v-310f94da>Redis</header><hr data-v-310f94da><div class="excerpt" data-v-310f94da><h2>Redisson</h2>
<h3>demo</h3>
<div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"redis://10.8.0.78:6369"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 拿到客户端</span></span>
<span class="line"><span class="token class-name">RedissonClient</span> redisson <span class="token operator">=</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 普通互斥锁</span></span>
<span class="line"><span class="token class-name">RLock</span> lock <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 加锁</span></span>
<span class="line">    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">ThreadUtil</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 释放锁</span></span>
<span class="line">    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 读写锁，读写互斥，写写互斥，读读可同时进行</span></span>
<span class="line"><span class="token class-name">RReadWriteLock</span> readWriteLock <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getReadWriteLock</span><span class="token punctuation">(</span><span class="token string">"readWrite"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">RLock</span> rLock <span class="token operator">=</span> readWriteLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">rLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// ....</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="article-info" data-v-310f94da><span class="author" data-v-310f94da>shuiMu</span><span class="date" data-v-310f94da>2021-09-10</span><span class="category" data-v-310f94da>分类: 技术</span><span class="tag" data-v-310f94da>标签: Redis, Redisson</span></div></article><article class="article" data-v-310f94da><header class="title" data-v-310f94da>ElasticSearch</header><hr data-v-310f94da><div class="excerpt" data-v-310f94da><h2>docker 启动安装</h2>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># es 单机启动 </span></span>
<span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> es <span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token punctuation">\</span></span>
<span class="line"><span class="token parameter variable">-e</span> <span class="token assign-left variable">discovery.type</span><span class="token operator">=</span>single-node <span class="token punctuation">\</span></span>
<span class="line"><span class="token parameter variable">-e</span> <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-Xms256m -Xmx256m"</span> <span class="token punctuation">\</span></span>
<span class="line"><span class="token parameter variable">-d</span> elasticsearch:7.16.2 <span class="token punctuation">\</span></span>
<span class="line"><span class="token parameter variable">-v</span> /Users/lipeng/docker/elasticsearch/plugins:/usr/share/elasticsearch/plugins <span class="token punctuation">\</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># kibana 启动</span></span>
<span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> kibana <span class="token parameter variable">-e</span> <span class="token assign-left variable">ELASTICSEARCH_HOSTS</span><span class="token operator">=</span>http://localhost:9200 <span class="token parameter variable">-p</span> <span class="token number">5601</span>:5601 <span class="token punctuation">\</span></span>
<span class="line"><span class="token parameter variable">-d</span> kibana:7.16.2</span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="article-info" data-v-310f94da><span class="author" data-v-310f94da>shuiMu</span><span class="date" data-v-310f94da>2021-08-20</span><span class="category" data-v-310f94da>分类: 技术</span><span class="tag" data-v-310f94da>标签: elasticSearch</span></div></article><article class="article" data-v-310f94da><header class="title" data-v-310f94da>Redis</header><hr data-v-310f94da><div class="excerpt" data-v-310f94da><h2>Redis 为什么这么快？</h2>
<blockquote>
<p>reactor 模式：反应器模式</p>
</blockquote>
<ul>
<li></li>
</ul>
<h2>扩展数据结构</h2>
<h4>HyperLogLog</h4>
<blockquote>
<p>计算uv值，但并不准确</p>
</blockquote>
<h3>rax树</h3>
<blockquote>
<p>trie树</p>
</blockquote>
<h2>哨兵</h2>
<h3>主从同步原理</h3>
<p><img src="/redis.assets/image-20220109204259035.png" alt="image-20220109204259035"></p></div><div class="article-info" data-v-310f94da><span class="author" data-v-310f94da>shuiMu</span><span class="date" data-v-310f94da>2021-07-01</span><span class="category" data-v-310f94da>分类: 技术</span><span class="tag" data-v-310f94da>标签: Redis</span></div></article><article class="article" data-v-310f94da><header class="title" data-v-310f94da>Kafka</header><hr data-v-310f94da><div class="excerpt" data-v-310f94da><h2>Kafka简介：</h2>
<p>Kafka是最初由Linkedin公司开发，是一个分布式、支持分区的（partition）、多副本的（replica），基于zookeeper协调的分布式消息系统，它的最大的特性就是可以实时的处理大量数据以满足各种需求场景：比如基于hadoop的批处理系统、低延迟的实时系统、Storm/Spark流式处理引擎，web/nginx日志、访问日志，消息服务等等，用scala语言编写，Linkedin于2010年贡献给了Apache基金会并成为顶级开源 项目。</p>
<h2>安装维护</h2>
<h3>命令操作</h3>
<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># zk 安装</span></span>
<span class="line"><span class="token function">wget</span> https://mirror.bit.edu.cn/apache/zookeeper/zookeeper‐3.5.8/apache‐zookeeper‐3.5.8‐bin.tar.gz </span>
<span class="line"><span class="token function">tar</span> ‐zxvf apache‐zookeeper‐3.5.8‐bin.tar.gz</span>
<span class="line"><span class="token builtin class-name">cd</span> apache‐zookeeper‐3.5.8‐bin </span>
<span class="line"><span class="token function">cp</span> conf/zoo_sample.cfg conf/zoo.cfg </span>
<span class="line"><span class="token comment"># 启动zookeeper </span></span>
<span class="line">bin/zkServer.sh start </span>
<span class="line">bin/zkCli.sh </span>
<span class="line"><span class="token comment">#查看zk的根目录相关节点</span></span>
<span class="line"><span class="token function">ls</span> / </span>
<span class="line"></span>
<span class="line"><span class="token comment"># kafka 安装</span></span>
<span class="line"><span class="token comment"># 2.11是scala的版本，2.4.1是kafka的版本 </span></span>
<span class="line"><span class="token function">wget</span> https://mirror.bit.edu.cn/apache/kafka/2.4.1/kafka_2.11‐2.4.1.tgz </span>
<span class="line"><span class="token function">tar</span> ‐xzf kafka_2.11‐2.4.1.tgz </span>
<span class="line"><span class="token builtin class-name">cd</span> kafka_2.11‐2.4.1</span>
<span class="line"><span class="token comment">#broker.id属性在kafka集群中必须要是唯一 </span></span>
<span class="line"><span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">0</span> </span>
<span class="line"><span class="token comment">#kafka部署的机器ip和提供服务的端口号</span></span>
<span class="line"><span class="token assign-left variable">listeners</span><span class="token operator">=</span>PLAINTEXT://localhost:9092 </span>
<span class="line"><span class="token comment">#kafka的消息存储文件 </span></span>
<span class="line"><span class="token assign-left variable">log.dir</span><span class="token operator">=</span>/usr/local/data/kafka‐logs </span>
<span class="line"><span class="token comment">#kafka连接zookeeper的地址 </span></span>
<span class="line"><span class="token assign-left variable">zookeeper.connect</span><span class="token operator">=</span>localhost:2181</span>
<span class="line"><span class="token comment"># 启动kafka，运行日志在logs目录的server.log文件里 </span></span>
<span class="line">bin/kafka‐server‐start.sh ‐daemon config/server.properties </span>
<span class="line"><span class="token comment">#后台启动，不会打印日志到控制台 3 或者用 </span></span>
<span class="line">bin/kafka‐server‐start.sh config/server.properties <span class="token operator">&amp;</span> </span>
<span class="line"><span class="token comment"># 我们进入zookeeper目录通过zookeeper客户端查看下zookeeper的目录树 </span></span>
<span class="line">bin/zkCli.sh </span>
<span class="line"><span class="token function">ls</span> / <span class="token comment">#查看zk的根目录kafka相关节点 </span></span>
<span class="line"><span class="token function">ls</span> /brokers/ids <span class="token comment">#查看kafka节点 </span></span>
<span class="line"><span class="token comment"># 停止kafka </span></span>
<span class="line">bin/kafka‐server‐stop.sh</span>
<span class="line"><span class="token comment">#创建名为 test 的 topic,通过手工的方式创建Topic，当producer发布一个消息到某个指定的Topic，这个Topic如果不存在，就自动创建</span></span>
<span class="line"><span class="token comment">#partitions 分区数</span></span>
<span class="line"><span class="token comment">#replication-factor 副本数</span></span>
<span class="line">bin/kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--zookeeper</span> localhost:2181 --replication-factor <span class="token number">3</span> <span class="token parameter variable">--partitions</span> <span class="token number">3</span> <span class="token parameter variable">--topic</span> topic_test2</span>
<span class="line"><span class="token comment">#查看kafka中目前存在的topic</span></span>
<span class="line">bin/kafka-topics.sh <span class="token parameter variable">--list</span> <span class="token parameter variable">--zookeeper</span> localhost:2181</span>
<span class="line"><span class="token comment">#删除主题</span></span>
<span class="line">bin/kafka-topics.sh <span class="token parameter variable">--delete</span> <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--zookeeper</span> localhost:2181</span>
<span class="line"><span class="token comment">#发送消息,每行都是一条消息</span></span>
<span class="line">bin/kafka-console-producer.sh --broker-list localhost:9092 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> </span>
<span class="line"><span class="token operator">&gt;</span>this is a msg</span>
<span class="line"><span class="token operator">&gt;</span>this is a another msg </span>
<span class="line"><span class="token comment">#消费消息</span></span>
<span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span></span>
<span class="line"><span class="token comment">#如果想要消费之前的消息可以通过--from-beginning参数指定，如下命令：</span></span>
<span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 </span>
<span class="line"><span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> </span>
<span class="line"><span class="token comment">#消费多主题</span></span>
<span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--whitelist</span> <span class="token string">"test|test-2"</span></span>
<span class="line"><span class="token comment">#单播消费,一条消息只能被某一个消费者消费的模式，类似queue模式，只需让所有消费者在同一个消费组里即可</span></span>
<span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092  --consumer-property <span class="token assign-left variable">group.id</span><span class="token operator">=</span>testGroup <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span></span>
<span class="line"><span class="token comment">#多播消费 发布订阅模式，指定到不同的消费组中</span></span>
<span class="line">bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --consumer-property <span class="token assign-left variable">group.id</span><span class="token operator">=</span>testGroup-2 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span></span>
<span class="line"><span class="token comment">#查看消费组名称</span></span>
<span class="line">bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--list</span> </span>
<span class="line"><span class="token comment">#查看消费组的消费偏移量</span></span>
<span class="line"><span class="token comment">#current-offset：当前消费组的已消费偏移量</span></span>
<span class="line"><span class="token comment">#log-end-offset：主题对应分区消息的结束偏移量(HW)</span></span>
<span class="line"><span class="token comment">#lag：当前消费组未消费的消息数</span></span>
<span class="line">bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--describe</span> <span class="token parameter variable">--group</span> testGroup-2</span>
<span class="line"><span class="token comment">#增加 partitions 数量</span></span>
<span class="line">bin/kafka-topics.sh <span class="token parameter variable">-alter</span> <span class="token parameter variable">--partitions</span> <span class="token number">3</span> <span class="token parameter variable">--zookeeper</span> localhost:2181 <span class="token parameter variable">--topic</span> test5</span>
<span class="line"><span class="token comment">#查看 topic 状态</span></span>
<span class="line">bin/kafka-topics.sh <span class="token parameter variable">--describe</span> <span class="token parameter variable">--zookeeper</span> <span class="token number">172.23</span>.4.32:2181/kafka/product/kafka821 <span class="token parameter variable">--topic</span> topic_test2</span>
<span class="line"></span>
<span class="line"><span class="token comment">#临时设置日志存储时间</span></span>
<span class="line">bin/kafka-configs.sh  <span class="token parameter variable">--zookeeper</span> <span class="token number">172.23</span>.4.32:2181/kafka/product/kafka821 <span class="token parameter variable">--alter</span> --add-config <span class="token string">'retention.ms=4320000'</span> --entity-name topic_tset2 --entity-type topics</span>
<span class="line"><span class="token comment">#删除设置</span></span>
<span class="line">bin/kafka-configs.sh  <span class="token parameter variable">--zookeeper</span> <span class="token number">172.23</span>.4.32:2181/kafka/product/kafka821 <span class="token parameter variable">--alter</span> --delete-config <span class="token string">'retention.ms'</span> --entity-name topic_tset2 --entity-type topics</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 如果是java客户端，查看消费offset偏移量时，需要带上 --new-consumer 参数</span></span>
<span class="line">bin/kafka-consumer-groups.sh --new-consumer --bootstrap-server <span class="token number">172.23</span>.4.32:9092,172.23.4.33:9092,172.23.4.33:9093 <span class="token parameter variable">--group</span> nike_callback_consumer3 <span class="token parameter variable">--describe</span></span>
<span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="article-info" data-v-310f94da><span class="author" data-v-310f94da>shuiMu</span><span class="date" data-v-310f94da>2021-05-02</span><span class="category" data-v-310f94da>分类: 技术</span><span class="tag" data-v-310f94da>标签: kafka</span></div></article><!--]--></div></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-B6K0T__V.js" defer></script>
  </body>
</html>
